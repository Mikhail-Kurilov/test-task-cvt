{"ast":null,"code":"class GameDrPill {\n  constructor({\n    id,\n    callbacks\n  }) {\n    this.canvas = document.getElementById(id);\n    this.context = this.canvas.getContext('2d');\n    this.canvas.width = 560;\n    this.canvas.height = 560;\n    this.canvas.addEventListener('click', event => this.clickCell(event));\n    this.canvas.addEventListener('mousemove', event => this.moveCell(event));\n    this.canvas.addEventListener('mouseup', () => this.upCell());\n    this.canvas.addEventListener('mousedown', event => this.downCell(event));\n    this.ADD_PILLS = 10;\n    this.FIELD_SIZE = 8;\n    this.ROUND_TIME = 60; // sec\n\n    this.SIZE = 70;\n    this.callbacks = callbacks;\n    this.field = [];\n    this.sec = 0;\n    this.interval = null;\n    this.currentPills = 0;\n    this.requirePills = 20;\n    this.vaccineScore = 0;\n    this.firstStep = true;\n    this.x = -1;\n    this.y = -1;\n    this.isDrug = null;\n    this.drugX = -1;\n    this.drugY = -1;\n    this.booms = [];\n    this.boomImages = [];\n    this.boomImages.push(new Image());\n    this.boomImages[0].src = '/img/1.png';\n    this.boomImages.push(new Image());\n    this.boomImages[1].src = '/img/2.png';\n    this.boomImages.push(new Image());\n    this.boomImages[2].src = '/img/3.png';\n    this.boomImages.push(new Image());\n    this.boomImages[3].src = '/img/4.png';\n    this.boomImages.push(new Image());\n    this.boomImages[4].src = '/img/5.png';\n    this.boomImages.push(new Image());\n    this.boomImages[5].src = '/img/6.png';\n    this.boomImages.push(new Image());\n    this.boomImages[6].src = '/img/7.png';\n    this.boomImages.push(new Image());\n    this.boomImages[7].src = '/img/8.png';\n    this.boomImages.push(new Image());\n    this.boomImages[8].src = '/img/9.png';\n    this.boomImages.push(new Image());\n    this.boomImages[9].src = '/img/10.png';\n    this.boomImages.push(new Image());\n    this.boomImages[10].src = '/img/11.png';\n    this.pills = [null];\n    this.pills.push(new Image());\n    this.pills[1].src = '/img/pill_1.png';\n\n    this.pills[1].onload = () => {\n      this.pills.push(new Image());\n      this.pills[2].src = '/img/pill_2.png';\n\n      this.pills[2].onload = () => {\n        this.pills.push(new Image());\n        this.pills[3].src = '/img/pill_5.png';\n\n        this.pills[3].onload = () => {\n          this.pills.push(new Image());\n          this.pills[4].src = '/img/pill_8.png';\n\n          this.pills[4].onload = () => {\n            this.pills.push(new Image());\n            this.pills[5].src = '/img/pill_10.png';\n\n            this.pills[5].onload = () => this.render();\n          };\n        };\n      };\n    };\n\n    for (let i = 0; i < this.FIELD_SIZE; i++) {\n      this.field.push([]);\n\n      for (let j = 0; j < this.FIELD_SIZE; j++) {\n        this.field[i][j] = 1 + Math.floor(Math.random() * 5);\n      }\n    }\n  }\n\n  startTimeUpdate() {\n    if (this.interval) {\n      this.sec = 0;\n      clearInterval(this.interval);\n    }\n\n    this.interval = setInterval(() => {\n      this.sec++;\n\n      if (this.sec >= this.ROUND_TIME) {\n        // закончить игру\n        clearInterval(this.interval);\n        this.callbacks.endGame(this.vaccineScore);\n        return;\n      }\n\n      this.callbacks.timeTick(this.ROUND_TIME - this.sec);\n    }, 1000);\n  }\n\n  move(i1, j1, i2, j2) {\n    if (i1 === i2 && Math.abs(j1 - j2) === 1 || Math.abs(i1 - i2) === 1 && j1 === j2) {\n      let c = this.field[i1][j1];\n      this.field[i1][j1] = this.field[i2][j2];\n      this.field[i2][j2] = c;\n\n      if (this.firstStep) {\n        // старт счетчика времени\n        this.firstStep = false;\n        this.startTimeUpdate();\n      }\n\n      this.render();\n      this.getStatus();\n      return true;\n    }\n\n    return false;\n  }\n\n  moveCell(event) {\n    if (this.isDrug) {\n      if (this.drugX >= 0 && this.drugY >= 0) {\n        this.render();\n\n        if (this.field[this.drugX][this.drugY]) {\n          this.context.drawImage(this.pills[this.field[this.drugX][this.drugY]], event.offsetX - this.SIZE / 2, event.offsetY - this.SIZE / 2, this.SIZE, this.SIZE);\n          let x = Math.floor(event.offsetX / this.SIZE);\n          let y = Math.floor(event.offsetY / this.SIZE);\n\n          if (Math.abs(x + y - (this.drugX + this.drugY)) === 1) {\n            this.move(this.drugX, this.drugY, x, y);\n            this.upCell();\n          }\n        }\n      }\n    }\n  }\n\n  upCell() {\n    this.isDrug = false;\n    this.drugX = -1;\n    this.drugY = -1;\n  }\n\n  downCell(event) {\n    this.isDrug = true;\n    this.drugX = Math.floor(event.offsetX / this.SIZE);\n    this.drugY = Math.floor(event.offsetY / this.SIZE);\n  }\n\n  clickCell(event) {\n    if (this.x >= 0 && this.y >= 0) {\n      let x = Math.floor(event.offsetX / this.SIZE);\n      let y = Math.floor(event.offsetY / this.SIZE);\n      this.move(this.x, this.y, x, y);\n      this.x = -1;\n      this.y = -1;\n    } else {\n      this.x = Math.floor(event.offsetX / this.SIZE);\n      this.y = Math.floor(event.offsetY / this.SIZE);\n    }\n  }\n\n  dropOneCell(i, j) {\n    if (j === 0) {\n      this.field[i][j] = 1 + Math.floor(Math.random() * 5);\n    } else {\n      for (let k = j; k >= 0; k--) {\n        if (this.field[i][k - 1] !== undefined) {\n          this.field[i][k] = this.field[i][k - 1];\n          this.field[i][k - 1] = 0;\n        } else {\n          this.field[i][k] = 1 + Math.floor(Math.random() * 5);\n        }\n      }\n    }\n  }\n\n  dropElements() {\n    for (let j = 0; j < this.FIELD_SIZE; j++) {\n      for (let i = 0; i < this.FIELD_SIZE; i++) {\n        if (this.field[i][j] === 0) {\n          this.dropOneCell(i, j);\n          this.render();\n        }\n      }\n    }\n  }\n\n  getStatus() {\n    let a1 = 0;\n    let a2 = 0; // пробежаться по столбцам\n\n    for (let i = 0; i < this.FIELD_SIZE; i++) {\n      a1 = 0;\n      a2 = 0;\n\n      for (let j = 0; j < this.FIELD_SIZE; j++) {\n        if (a1 && a1 === a2 && a2 === this.field[i][j]) {\n          this.field[i][j] = 0;\n          this.field[i][j - 1] = 0;\n          this.field[i][j - 2] = 0;\n          this.booms.push({\n            i,\n            j,\n            currentImage: -1\n          });\n          this.booms.push({\n            i,\n            j: j - 1,\n            currentImage: -1\n          });\n          this.booms.push({\n            i,\n            j: j - 2,\n            currentImage: -1\n          });\n          setTimeout(() => this.dropElements(), 1500);\n          this.render();\n          this.callbacks.addPills(3);\n        } else if (a1 && a1 === a2 && a2 !== this.field[i][j]) {\n          a1 = this.field[i][j];\n          a2 = 0;\n        } else if (a1 && a1 === this.field[i][j]) {\n          a2 = this.field[i][j];\n        } else {\n          a1 = this.field[i][j];\n        }\n      }\n    } // пробежаться по строки\n\n\n    for (let j = 0; j < this.FIELD_SIZE; j++) {\n      a1 = 0;\n      a2 = 0;\n\n      for (let i = 0; i < this.FIELD_SIZE; i++) {\n        if (a1 && a1 === a2 && a2 === this.field[i][j]) {\n          this.field[i][j] = 0;\n          this.field[i - 1][j] = 0;\n          this.field[i - 2][j] = 0;\n          this.booms.push({\n            i,\n            j,\n            currentImage: -1\n          });\n          this.booms.push({\n            i: i - 1,\n            j,\n            currentImage: -1\n          });\n          this.booms.push({\n            i: i - 2,\n            j,\n            currentImage: -1\n          });\n          setTimeout(() => this.dropElements(), 1500);\n          this.render();\n          this.callbacks.addPills(3);\n        } else if (a1 && a1 === a2 && a2 !== this.field[i][j]) {\n          a1 = this.field[i][j];\n          a2 = 0;\n        } else if (a1 && a1 === this.field[i][j]) {\n          a2 = this.field[i][j];\n        } else {\n          a1 = this.field[i][j];\n        }\n      }\n    }\n  }\n\n  restartTime() {\n    this.startTimeUpdate();\n  }\n\n  clear() {\n    this.context.fillStyle = 'purple';\n    this.context.fillRect(0, 0, this.canvas.width, this.canvas.height);\n  }\n\n  render() {\n    this.clear(); // очистка\n    // нарисовать пилюльки\n\n    for (let i = 0; i < this.field.length; i++) {\n      for (let j = 0; j < this.field.length; j++) {\n        if (this.field[i][j]) {\n          this.context.drawImage(this.pills[this.field[i][j]], i * this.SIZE, j * this.SIZE, this.SIZE, this.SIZE);\n        } else {\n          this.context.fillRect(i * this.SIZE, j * this.SIZE, this.SIZE, this.SIZE);\n        }\n      }\n    } // нарисовать бумсы\n\n\n    let refresh = false;\n\n    for (let i = this.booms.length - 1; i >= 0; i--) {\n      const boom = this.booms[i];\n\n      if (boom) {\n        boom.currentImage++;\n\n        if (boom.currentImage >= this.boomImages.length) {\n          this.booms.splice(i, 1);\n        } else {\n          const i = boom.i;\n          const j = boom.j;\n          this.context.drawImage(this.boomImages[boom.currentImage], i * this.SIZE, j * this.SIZE, this.SIZE, this.SIZE);\n          refresh = true;\n        }\n      }\n    }\n\n    if (refresh) {\n      setTimeout(() => this.render(), 125);\n    }\n  }\n\n}\n\nexport default GameDrPill;","map":{"version":3,"sources":["D:/test/vs_studio/dr-pill/src/components/Game/GameDrPill.js"],"names":["GameDrPill","constructor","id","callbacks","canvas","document","getElementById","context","getContext","width","height","addEventListener","event","clickCell","moveCell","upCell","downCell","ADD_PILLS","FIELD_SIZE","ROUND_TIME","SIZE","field","sec","interval","currentPills","requirePills","vaccineScore","firstStep","x","y","isDrug","drugX","drugY","booms","boomImages","push","Image","src","pills","onload","render","i","j","Math","floor","random","startTimeUpdate","clearInterval","setInterval","endGame","timeTick","move","i1","j1","i2","j2","abs","c","getStatus","drawImage","offsetX","offsetY","dropOneCell","k","undefined","dropElements","a1","a2","currentImage","setTimeout","addPills","restartTime","clear","fillStyle","fillRect","length","refresh","boom","splice"],"mappings":"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","sourcesContent":["class GameDrPill {\r\n    constructor({ id, callbacks }) {\r\n        this.canvas = document.getElementById(id);\r\n        this.context = this.canvas.getContext('2d');\r\n        this.canvas.width = 560;\r\n        this.canvas.height = 560;\r\n        this.canvas.addEventListener('click', (event) => this.clickCell(event));\r\n        this.canvas.addEventListener('mousemove', (event) => this.moveCell(event));\r\n        this.canvas.addEventListener('mouseup', () => this.upCell());\r\n        this.canvas.addEventListener('mousedown', (event) => this.downCell(event));\r\n\r\n        this.ADD_PILLS = 10;\r\n        this.FIELD_SIZE = 8;\r\n        this.ROUND_TIME = 60; // sec\r\n        this.SIZE = 70;\r\n\r\n        this.callbacks = callbacks;\r\n\r\n        this.field = [];\r\n        this.sec = 0;\r\n        this.interval = null;\r\n        this.currentPills = 0;\r\n        this.requirePills = 20;\r\n        this.vaccineScore = 0;\r\n        this.firstStep = true;\r\n        this.x = -1;\r\n        this.y = -1;\r\n        this.isDrug = null;\r\n        this.drugX = -1;\r\n        this.drugY = -1;\r\n\r\n        this.booms = [];\r\n        this.boomImages = [];\r\n        this.boomImages.push(new Image());\r\n        this.boomImages[0].src = '/img/1.png';\r\n        this.boomImages.push(new Image());\r\n        this.boomImages[1].src = '/img/2.png';\r\n        this.boomImages.push(new Image());\r\n        this.boomImages[2].src = '/img/3.png';\r\n        this.boomImages.push(new Image());\r\n        this.boomImages[3].src = '/img/4.png';\r\n        this.boomImages.push(new Image());\r\n        this.boomImages[4].src = '/img/5.png';\r\n        this.boomImages.push(new Image());\r\n        this.boomImages[5].src = '/img/6.png';\r\n        this.boomImages.push(new Image());\r\n        this.boomImages[6].src = '/img/7.png';\r\n        this.boomImages.push(new Image());\r\n        this.boomImages[7].src = '/img/8.png';\r\n        this.boomImages.push(new Image());\r\n        this.boomImages[8].src = '/img/9.png';\r\n        this.boomImages.push(new Image());\r\n        this.boomImages[9].src = '/img/10.png';\r\n        this.boomImages.push(new Image());\r\n        this.boomImages[10].src = '/img/11.png';\r\n\r\n        this.pills = [null];\r\n        this.pills.push(new Image());\r\n        this.pills[1].src = '/img/pill_1.png';\r\n        this.pills[1].onload = () => {\r\n            this.pills.push(new Image());\r\n            this.pills[2].src = '/img/pill_2.png';\r\n            this.pills[2].onload = () => {\r\n                this.pills.push(new Image());\r\n                this.pills[3].src = '/img/pill_5.png';\r\n                this.pills[3].onload = () => {\r\n                    this.pills.push(new Image());\r\n                    this.pills[4].src = '/img/pill_8.png';\r\n                    this.pills[4].onload = () => {\r\n                        this.pills.push(new Image());\r\n                        this.pills[5].src = '/img/pill_10.png';\r\n                        this.pills[5].onload = () => this.render();\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        for (let i = 0; i < this.FIELD_SIZE; i++) {\r\n            this.field.push([]);\r\n            for (let j = 0; j < this.FIELD_SIZE; j++) {\r\n                this.field[i][j] = 1 + Math.floor(Math.random() * 5);\r\n            }\r\n        }\r\n    }\r\n\r\n    startTimeUpdate() {\r\n        if (this.interval) {\r\n            this.sec = 0;\r\n            clearInterval(this.interval);\r\n        }\r\n        this.interval = setInterval(() => {\r\n            this.sec++;\r\n            if (this.sec >= this.ROUND_TIME) { // закончить игру\r\n                clearInterval(this.interval);\r\n                this.callbacks.endGame(this.vaccineScore);\r\n                return;\r\n            }\r\n            this.callbacks.timeTick(this.ROUND_TIME - this.sec);\r\n        }, 1000);\r\n    }\r\n\r\n    move(i1, j1, i2, j2) {\r\n        if ((i1 === i2 && Math.abs(j1 - j2) === 1) ||\r\n            (Math.abs(i1 - i2) === 1 && j1 === j2)) {\r\n            let c = this.field[i1][j1];\r\n            this.field[i1][j1] = this.field[i2][j2];\r\n            this.field[i2][j2] = c;\r\n            if (this.firstStep) { // старт счетчика времени\r\n                this.firstStep = false;\r\n                this.startTimeUpdate();\r\n            }\r\n            this.render();\r\n            this.getStatus();\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    moveCell(event) {\r\n        if (this.isDrug) {\r\n            if (this.drugX >= 0 && this.drugY >= 0) {\r\n                this.render();\r\n                if (this.field[this.drugX][this.drugY]) {\r\n                    this.context.drawImage(\r\n                        this.pills[this.field[this.drugX][this.drugY]],\r\n                        event.offsetX - this.SIZE / 2,\r\n                        event.offsetY - this.SIZE / 2,\r\n                        this.SIZE,\r\n                        this.SIZE\r\n                    );\r\n                    let x = Math.floor(event.offsetX / this.SIZE);\r\n                    let y = Math.floor(event.offsetY / this.SIZE);\r\n                    if (Math.abs((x + y) - (this.drugX + this.drugY)) === 1) {\r\n                        this.move(this.drugX, this.drugY, x, y);\r\n                        this.upCell();\r\n                    }    \r\n                }\r\n            }\r\n        }\r\n    }\r\n    upCell() {\r\n        this.isDrug = false;\r\n        this.drugX = -1;\r\n        this.drugY = -1;\r\n    }\r\n\r\n    downCell(event) {\r\n        this.isDrug = true;\r\n        this.drugX = Math.floor(event.offsetX / this.SIZE);\r\n        this.drugY = Math.floor(event.offsetY / this.SIZE);\r\n    }\r\n\r\n    clickCell(event) {\r\n        if (this.x >= 0 && this.y >= 0) {\r\n            let x = Math.floor(event.offsetX / this.SIZE);\r\n            let y = Math.floor(event.offsetY / this.SIZE);\r\n            this.move(this.x, this.y, x, y);\r\n            this.x = -1;\r\n            this.y = -1;\r\n        } else {\r\n            this.x = Math.floor(event.offsetX / this.SIZE);\r\n            this.y = Math.floor(event.offsetY / this.SIZE);\r\n        }\r\n    }\r\n\r\n    dropOneCell(i, j) {\r\n        if (j === 0) {\r\n            this.field[i][j] = 1 + Math.floor(Math.random() * 5);\r\n        } else {\r\n            for (let k = j; k >= 0; k--) {\r\n                if (this.field[i][k - 1] !== undefined) {\r\n                    this.field[i][k] = this.field[i][k - 1];\r\n                    this.field[i][k - 1] = 0;\r\n                } else {\r\n                    this.field[i][k] = 1 + Math.floor(Math.random() * 5)\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    dropElements() {\r\n        for (let j = 0; j < this.FIELD_SIZE; j++) {\r\n            for (let i = 0; i < this.FIELD_SIZE; i++) {\r\n                if (this.field[i][j] === 0) {\r\n                    this.dropOneCell(i, j);\r\n                    this.render();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    getStatus() {\r\n        let a1 = 0;\r\n        let a2 = 0;\r\n        // пробежаться по столбцам\r\n        for (let i = 0; i < this.FIELD_SIZE; i++) {\r\n            a1 = 0;\r\n            a2 = 0;\r\n            for (let j = 0; j < this.FIELD_SIZE; j++) {\r\n                if (a1 && a1 === a2 && a2 === this.field[i][j]) {\r\n                    this.field[i][j] = 0;\r\n                    this.field[i][j - 1] = 0;\r\n                    this.field[i][j - 2] = 0;\r\n                    this.booms.push({ i, j, currentImage: -1 });\r\n                    this.booms.push({ i, j: j - 1, currentImage: -1 });\r\n                    this.booms.push({ i, j: j - 2, currentImage: -1 });\r\n                    setTimeout(() => this.dropElements(), 1500);\r\n                    this.render();\r\n                    this.callbacks.addPills(3);\r\n                } else if (a1 && a1 === a2 && a2 !== this.field[i][j]) {\r\n                    a1 = this.field[i][j];\r\n                    a2 = 0;\r\n                } else if (a1 && a1 === this.field[i][j]) {\r\n                    a2 = this.field[i][j];\r\n                } else {\r\n                    a1 = this.field[i][j];\r\n                }\r\n            }\r\n        }\r\n        // пробежаться по строки\r\n        for (let j = 0; j < this.FIELD_SIZE; j++) {\r\n            a1 = 0;\r\n            a2 = 0;\r\n            for (let i = 0; i < this.FIELD_SIZE; i++) {\r\n                if (a1 && a1 === a2 && a2 === this.field[i][j]) {\r\n                    this.field[i][j] = 0;\r\n                    this.field[i - 1][j] = 0;\r\n                    this.field[i - 2][j] = 0;\r\n                    this.booms.push({ i, j, currentImage: -1 });\r\n                    this.booms.push({ i: i - 1, j, currentImage: -1 });\r\n                    this.booms.push({ i: i - 2, j, currentImage: -1 });\r\n                    setTimeout(() => this.dropElements(), 1500);\r\n                    this.render();\r\n                    this.callbacks.addPills(3);\r\n                } else if (a1 && a1 === a2 && a2 !== this.field[i][j]) {\r\n                    a1 = this.field[i][j];\r\n                    a2 = 0;\r\n                } else if (a1 && a1 === this.field[i][j]) {\r\n                    a2 = this.field[i][j];\r\n                } else {\r\n                    a1 = this.field[i][j];\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    restartTime() {\r\n        this.startTimeUpdate();\r\n    }\r\n\r\n    clear() {\r\n        this.context.fillStyle = 'purple';\r\n        this.context.fillRect(0, 0, this.canvas.width, this.canvas.height);\r\n    }\r\n\r\n    render() {\r\n        this.clear(); // очистка\r\n        // нарисовать пилюльки\r\n        for (let i = 0; i < this.field.length; i++) {\r\n            for (let j = 0; j < this.field.length; j++) {\r\n                if (this.field[i][j]) {\r\n                    this.context.drawImage(this.pills[this.field[i][j]], i * this.SIZE, j * this.SIZE, this.SIZE, this.SIZE);\r\n                } else {\r\n                    this.context.fillRect(i * this.SIZE, j * this.SIZE, this.SIZE, this.SIZE)\r\n                }\r\n            }\r\n        }\r\n        // нарисовать бумсы\r\n        let refresh = false;\r\n        for (let i = this.booms.length - 1; i >= 0; i--) {\r\n            const boom = this.booms[i];\r\n            if (boom) {\r\n                boom.currentImage++;\r\n                if (boom.currentImage >= this.boomImages.length) {\r\n                    this.booms.splice(i, 1);\r\n                } else {\r\n                    const i = boom.i;\r\n                    const j = boom.j;\r\n                    this.context.drawImage(this.boomImages[boom.currentImage], i * this.SIZE, j * this.SIZE, this.SIZE, this.SIZE);\r\n                    refresh = true;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (refresh) {\r\n            setTimeout(() => this.render(), 125);\r\n        }\r\n    }\r\n}\r\n\r\nexport default GameDrPill;"]},"metadata":{},"sourceType":"module"}